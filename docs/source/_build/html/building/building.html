
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Building ecs-install Image From Sources &#8212; ECS-CommunityEdition 3.2.2.0 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ECS Community Edition Installation Guides" href="../installation/ECS-Installation.html" />
    <link rel="prev" title="Welcome to ECS Community Edition’s documentation!" href="../index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../installation/ECS-Installation.html" title="ECS Community Edition Installation Guides"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="Welcome to ECS Community Edition’s documentation!"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">ECS-CommunityEdition 3.2.2.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="building-ecs-install-image-from-sources">
<h1>Building <code class="docutils literal notranslate"><span class="pre">ecs-install</span></code> Image From Sources<a class="headerlink" href="#building-ecs-install-image-from-sources" title="Permalink to this headline">¶</a></h1>
<p>The ECS-CommunityEdition git repository is also a build environment for
the <code class="docutils literal notranslate"><span class="pre">ecs-install</span></code> image.</p>
<div class="section" id="building-ecs-install-image-during-bootstrap-with-boostrap-sh">
<h2>Building <code class="docutils literal notranslate"><span class="pre">ecs-install</span></code> Image During Bootstrap with <code class="docutils literal notranslate"><span class="pre">boostrap.sh</span></code><a class="headerlink" href="#building-ecs-install-image-during-bootstrap-with-boostrap-sh" title="Permalink to this headline">¶</a></h2>
<p>If you’re hacking around in the install node code, then you’ll probably
want to build your own install node image at some point. The
<code class="docutils literal notranslate"><span class="pre">bootstrap.sh</span></code> script has options for accomplishing just this.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Usage</span><span class="p">]</span>
 <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>
    <span class="n">Display</span> <span class="n">this</span> <span class="n">help</span> <span class="n">text</span> <span class="ow">and</span> <span class="n">exit</span>
 <span class="o">--</span><span class="n">help</span><span class="o">-</span><span class="n">build</span>
    <span class="n">Display</span> <span class="n">build</span> <span class="n">environment</span> <span class="n">help</span> <span class="ow">and</span> <span class="n">exit</span>
 <span class="o">--</span><span class="n">version</span>
    <span class="n">Display</span> <span class="n">version</span> <span class="n">information</span> <span class="ow">and</span> <span class="n">exit</span>

<span class="p">[</span><span class="n">Build</span> <span class="n">Options</span><span class="p">]</span>
 <span class="o">--</span><span class="n">zero</span><span class="o">-</span><span class="n">fill</span><span class="o">-</span><span class="n">ova</span>
    <span class="n">Reduce</span> <span class="n">ephemera</span><span class="p">,</span> <span class="n">defrag</span><span class="p">,</span> <span class="ow">and</span> <span class="n">zerofill</span> <span class="n">the</span> <span class="n">instance</span> <span class="n">after</span> <span class="n">bootstrapping</span>
 <span class="o">--</span><span class="n">build</span><span class="o">-</span><span class="kn">from</span> <span class="o">&lt;</span><span class="n">URL</span><span class="o">&gt;</span>
    <span class="n">Use</span> <span class="n">the</span> <span class="n">Alpine</span> <span class="n">Linux</span> <span class="n">mirror</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">URL</span><span class="o">&gt;</span> <span class="n">to</span> <span class="n">build</span> <span class="n">the</span> <span class="n">ecs</span><span class="o">-</span><span class="n">install</span> <span class="n">image</span> <span class="n">locally</span><span class="o">.</span>
    <span class="n">Mirror</span> <span class="nb">list</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">wiki</span><span class="o">.</span><span class="n">alpinelinux</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">wiki</span><span class="o">/</span><span class="n">Alpine_Linux</span><span class="p">:</span><span class="n">Mirrors</span>
</pre></div>
</div>
<p>All you’ll need is a URL that points to an Alpine Linux mirror. For a
good default, you can use the GeoDB enabled CDN mirror, which should
auto-select a nearby mirror for you based on your public edge IP:
<a class="reference external" href="http://dl-cdn.alpinelinux.org/alpine/">http://dl-cdn.alpinelinux.org/alpine/</a></p>
<p>To tell bootstrap to build the image for you, just include the
<code class="docutils literal notranslate"><span class="pre">--build-from</span></code> argument on your command line, like so:</p>
<p><code class="docutils literal notranslate"><span class="pre">[admin&#64;localhost</span> <span class="pre">ECS-CommunityEdition]$</span> <span class="pre">./bootstrap.sh</span> <span class="pre">--build-from</span> <span class="pre">http://dl-cdn.alpinelinux.org/alpine/</span></code></p>
</div>
<div class="section" id="building-ecs-install-image-after-bootstrapping-with-build-image">
<h2>Building <code class="docutils literal notranslate"><span class="pre">ecs-install</span></code> Image After Bootstrapping with <code class="docutils literal notranslate"><span class="pre">build_image</span></code><a class="headerlink" href="#building-ecs-install-image-after-bootstrapping-with-build-image" title="Permalink to this headline">¶</a></h2>
<p>If you need to build the <code class="docutils literal notranslate"><span class="pre">ecs-install</span></code> image after bootstrapping, then
you’ll need to give a valid Alpine Linux mirror to your install node:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[admin@installer-230 ECS-CommunityEdition]$ build_image --update-mirror http://cache.local/alpine/
&gt; Updating bootstrap.conf to use Alpine Linux mirror http://cache.local/alpine/
</pre></div>
</div>
<p>Once the mirror is configured, you can then build the image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[admin@installer-230 ECS-CommunityEdition]$ build_image
&gt; Building image ecs-install
&gt; Build context is: local
&gt; Using custom registry: cache.local:5000
&gt; Tunneling through proxy: cache.local:3128
&gt; Checking Alpine Linux mirror
&gt; Generating Alpine Linux repositories file
&gt; Collecting artifacts
&gt; UI artifact is: ui/resources/docker/ecs-install.2.5.1-local.installer-230.4.tgz
INFO[0000] FROM cache.local:5000/alpine:3.6
INFO[0000] | Image sha256:37eec                          size=3.962 MB
INFO[0000] LABEL MAINTAINER=&#39;Travis Wichert &lt;travis.wichert@emc.com&gt;&#39;
INFO[0000] ENV ANSIBLE_CONFIG=&quot;/etc/ansible/ansible.cfg&quot;
INFO[0000] ENV ANSIBLE_HOSTS=&quot;/usr/local/src/ui/inventory.py&quot;
INFO[0000] Commit changes
INFO[0000] | Cached! Take image sha256:302bc    size=3.962 MB (+0 B)
INFO[0000] COPY ui/resources/docker/ecs-install-requirements.txt /etc/ecs-install-requirements.txt
INFO[0000] | Calculating tarsum for 1 files (465 B total)
INFO[0000] | Cached! Take image sha256:44a83    size=3.962 MB (+465 B)
INFO[0000] COPY ui/resources/docker/apk-repositories /etc/apk/repositories
INFO[0000] | Calculating tarsum for 1 files (239 B total)
INFO[0000] | Not cached
INFO[0000] | Created container 89e5a010f1b5 (image sha256:44a83)
INFO[0000] | Uploading files to container 89e5a010f1b5
INFO[0000] Commit changes
INFO[0001] | Result image is sha256:26c0f                size=3.962 MB (+239 B)
INFO[0001] | Removing container 89e5a010f1b5
INFO[0001] ENV http_proxy=http://cache.local:3128
INFO[0001] ENV pip_proxy=cache.local:3128
INFO[0001] Commit changes
INFO[0002] | Created container 49b210eacd7c (image sha256:26c0f)
INFO[0002] | Result image is sha256:d9d58                size=3.962 MB (+0 B)
INFO[0002] | Removing container 49b210eacd7c
INFO[0003] RUN apk -q update &amp;&amp;     apk -q --no-cache upgrade
INFO[0003] | Created container 856a966289a6 (image sha256:d9d58)
INFO[0005] Commit changes
INFO[0006] | Result image is sha256:a2978                size=6.855 MB (+2.893 MB)
INFO[0006] | Removing container 856a966289a6
INFO[0006] RUN apk -q --no-cache add python2 py-pip                             openssh-client sshpass openssl ca-certificates libffi libressl@edge_main                              pigz jq less                              opentracker aria2 mktorrent@edge_community                              ansible@edge_main
INFO[0006] | Created container 2c940cb6c2e6 (image sha256:a2978)
INFO[0016] Commit changes
INFO[0026] | Result image is sha256:b806e                size=124.4 MB (+117.6 MB)
INFO[0026] | Removing container 2c940cb6c2e6
INFO[0026] RUN mv /etc/profile.d/color_prompt /etc/profile.d/color_prompt.sh     &amp;&amp; ln -s /usr/local/src/ui/ansible /ansible     &amp;&amp; ln -s /usr/local/src/ui /ui     &amp;&amp; ln -s /usr/local/src /src     &amp;&amp; ln -s /usr/bin/python /usr/local/bin/python     &amp;&amp; mkdir -p /var/run/opentracker     &amp;&amp; chown nobody:nobody /var/run/opentracker
INFO[0027] | Created container a5a35a59e61a (image sha256:b806e)
INFO[0027] Commit changes
INFO[0029] | Result image is sha256:55ae2                size=124.4 MB (+295 B)
INFO[0029] | Removing container a5a35a59e61a
INFO[0029] RUN apk -q --no-cache add --update --virtual .build-deps musl-dev python2-dev libffi-dev                        build-base make openssl-dev linux-headers git gcc git-perl     &amp;&amp; if ! [ -z &quot;$pip_proxy&quot; ]; then             export pip_proxy=&quot;--proxy $pip_proxy&quot; &amp;&amp;             git config --global http.proxy &quot;$http_proxy&quot;        ;fi     &amp;&amp; pip install -q $pip_proxy --no-cache-dir -r /etc/ecs-install-requirements.txt     &amp;&amp; apk -q --no-cache --purge del .build-deps
INFO[0030] | Created container 4d07a461385a (image sha256:55ae2)
INFO[0184] Commit changes
INFO[0187] | Result image is sha256:79f09                size=151.1 MB (+26.68 MB)
INFO[0187] | Removing container 4d07a461385a
INFO[0187] RUN mkdir -p /etc/ansible
INFO[0188] | Created container 021968b10369 (image sha256:79f09)
INFO[0188] Commit changes
INFO[0190] | Result image is sha256:376dc                size=151.1 MB (+0 B)
INFO[0190] | Removing container 021968b10369
INFO[0191] COPY ui/resources/docker/ansible.cfg /etc/ansible/ansible.cfg
INFO[0191] | Calculating tarsum for 1 files (5.437 kB total)
INFO[0191] | Created container acf602cb1215 (image sha256:376dc)
INFO[0191] | Uploading files to container acf602cb1215
INFO[0191] Commit changes
INFO[0193] | Result image is sha256:a3b7d                size=151.1 MB (+5.437 kB)
INFO[0193] | Removing container acf602cb1215
INFO[0193] COPY ui/resources/docker/entrypoint.sh /usr/local/bin/entrypoint.sh
INFO[0193] | Calculating tarsum for 1 files (5.844 kB total)
INFO[0194] | Created container d2e1e94bba06 (image sha256:a3b7d)
INFO[0194] | Uploading files to container d2e1e94bba06
INFO[0194] Commit changes
INFO[0196] | Result image is sha256:c0530                size=151.1 MB (+5.844 kB)
INFO[0196] | Removing container d2e1e94bba06
INFO[0196] RUN chmod +x /usr/local/bin/entrypoint.sh
INFO[0197] | Created container 58814799d1c4 (image sha256:c0530)
INFO[0197] Commit changes
INFO[0199] | Result image is sha256:6fa79                size=151.1 MB (+0 B)
INFO[0199] | Removing container 58814799d1c4
INFO[0200] ENTRYPOINT [ &quot;/usr/local/bin/entrypoint.sh&quot; ]
INFO[0200] Commit changes
INFO[0200] | Created container dc4494fd062f (image sha256:6fa79)
INFO[0202] | Result image is sha256:481e1                size=151.1 MB (+0 B)
INFO[0202] | Removing container dc4494fd062f
INFO[0202] COPY ui/resources/docker/torrent.sh /usr/local/bin/torrent.sh
INFO[0202] | Calculating tarsum for 1 files (890 B total)
INFO[0203] | Created container 9f15d6413cd2 (image sha256:481e1)
INFO[0203] | Uploading files to container 9f15d6413cd2
INFO[0203] Commit changes
INFO[0205] | Result image is sha256:35f06                size=151.1 MB (+890 B)
INFO[0205] | Removing container 9f15d6413cd2
INFO[0205] COPY ui/resources/docker/ecs-install.2.5.1-local.installer-230.4.tgz /usr/local/src/ui.tgz
INFO[0205] | Calculating tarsum for 1 files (3.958 MB total)
INFO[0206] | Created container e6542b37ddc7 (image sha256:35f06)
INFO[0206] | Uploading files to container e6542b37ddc7
INFO[0206] Commit changes
INFO[0208] | Result image is sha256:161f5                size=155.1 MB (+3.958 MB)
INFO[0208] | Removing container e6542b37ddc7
INFO[0208] ENV http_proxy=
INFO[0208] ENV pip_proxy=
INFO[0208] VOLUME [ &quot;/opt&quot;, &quot;/usr&quot;, &quot;/var/log&quot;, &quot;/root&quot;, &quot;/etc&quot; ]
INFO[0208] LABEL VERSION=cache.local:5000/emccorp/ecs-install:2.5.1-local.installer-230.4
INFO[0208] ENV VERSION=cache.local:5000/emccorp/ecs-install:2.5.1-local.installer-230.4
INFO[0208] Commit changes
INFO[0213] | Created container 7beb4650354e (image sha256:161f5)
INFO[0216] | Result image is sha256:7bd3d                size=155.1 MB (+0 B)
INFO[0216] | Removing container 7beb4650354e
INFO[0217] TAG cache.local:5000/emccorp/ecs-install:2.5.1-local.installer-230.4
INFO[0217] | Tag sha256:7bd3d -&gt; cache.local:5000/emccorp/ecs-install:2.5.1-local.installer-230.4
INFO[0217] Cleaning up
INFO[0217] Successfully built sha256:7bd3d | final size 155.1 MB (+151.1 MB from the base image)
&gt; Tagging cache.local:5000/emccorp/ecs-install:2.5.1-local.installer-230.4 -&gt; emccorp/ecs-install:latest
</pre></div>
</div>
<p>The new image is automatically tagged :latest in the local repository
and replaces any previous :latest images.</p>
<p>You’ll then want to clean up the local Docker repository with this
command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[admin@installer-230 ECS-CommunityEdition]$ build_image --clean
&gt; Cleaning up...
&gt;      [build tmp containers]
&gt;      [ecs-install data containers]
&gt;      [exited containers]
&gt;      [dangling layers]
</pre></div>
</div>
</div>
<div class="section" id="making-quick-iterative-changes-to-an-existing-ecs-install-image-with-update-image">
<h2>Making Quick Iterative Changes to an Existing <code class="docutils literal notranslate"><span class="pre">ecs-install</span></code> Image with <code class="docutils literal notranslate"><span class="pre">update_image</span></code><a class="headerlink" href="#making-quick-iterative-changes-to-an-existing-ecs-install-image-with-update-image" title="Permalink to this headline">¶</a></h2>
<p>Building an image can take a long time. If you have not made any changes
to files that are used in the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">build</span></code> process, then you can
update an existing <code class="docutils literal notranslate"><span class="pre">ecs-install</span></code> data container with code changes
using the <code class="docutils literal notranslate"><span class="pre">update_image</span></code> macro:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[admin@installer-230 ECS-CommunityEdition]$ update_image
&gt; Updating image: ecs-install
&gt; Build context is: local
&gt; Tunneling through proxy: cache.local:3128
&gt; Cleaning up...
&gt;      [build tmp containers]
&gt;      [ecs-install data containers]
&gt;      [exited containers]
&gt;      [dangling layers]
&gt; Collecting artifacts
&gt; UI is: ui/resources/docker/ecs-install.2.5.1-local.installer-230.5.tgz
&gt; Creating new data container
&gt; Image updated.
</pre></div>
</div>
</div>
<div class="section" id="quickly-testing-ansible-changes-with-testbook">
<h2>Quickly Testing Ansible Changes with <code class="docutils literal notranslate"><span class="pre">testbook</span></code><a class="headerlink" href="#quickly-testing-ansible-changes-with-testbook" title="Permalink to this headline">¶</a></h2>
<p>If you’re working with Ansible within ECS Community Edition, you might
find yourself needing to test to see how your Ansible role is being
played from within the <code class="docutils literal notranslate"><span class="pre">ecs-install</span></code> image. You can do this by
modifying the files under the <code class="docutils literal notranslate"><span class="pre">testing</span></code> subdirectory of the Ansible
<code class="docutils literal notranslate"><span class="pre">roles</span></code> directory: <code class="docutils literal notranslate"><span class="pre">ui/ansible/roles/testing</span></code></p>
<p>After making your changes, run <code class="docutils literal notranslate"><span class="pre">update_image</span></code> as discussed above, and
then run <code class="docutils literal notranslate"><span class="pre">testbook</span></code> to execute your role. The <code class="docutils literal notranslate"><span class="pre">testbook</span></code> command
will automatically initialize a new data container, configure access
with the install node, and test your role directives.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Building <code class="docutils literal notranslate"><span class="pre">ecs-install</span></code> Image From Sources</a><ul>
<li><a class="reference internal" href="#building-ecs-install-image-during-bootstrap-with-boostrap-sh">Building <code class="docutils literal notranslate"><span class="pre">ecs-install</span></code> Image During Bootstrap with <code class="docutils literal notranslate"><span class="pre">boostrap.sh</span></code></a></li>
<li><a class="reference internal" href="#building-ecs-install-image-after-bootstrapping-with-build-image">Building <code class="docutils literal notranslate"><span class="pre">ecs-install</span></code> Image After Bootstrapping with <code class="docutils literal notranslate"><span class="pre">build_image</span></code></a></li>
<li><a class="reference internal" href="#making-quick-iterative-changes-to-an-existing-ecs-install-image-with-update-image">Making Quick Iterative Changes to an Existing <code class="docutils literal notranslate"><span class="pre">ecs-install</span></code> Image with <code class="docutils literal notranslate"><span class="pre">update_image</span></code></a></li>
<li><a class="reference internal" href="#quickly-testing-ansible-changes-with-testbook">Quickly Testing Ansible Changes with <code class="docutils literal notranslate"><span class="pre">testbook</span></code></a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../index.html"
                        title="previous chapter">Welcome to ECS Community Edition’s documentation!</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../installation/ECS-Installation.html"
                        title="next chapter">ECS Community Edition Installation Guides</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/building/building.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../installation/ECS-Installation.html" title="ECS Community Edition Installation Guides"
             >next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="Welcome to ECS Community Edition’s documentation!"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">ECS-CommunityEdition 3.2.2.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Dell-EMC.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.0.
    </div>
  </body>
</html>